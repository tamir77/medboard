<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MedNet â€” Revenue Distribution</title>
<link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700;800;900&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>

<!-- PASSWORD GATE -->
<style>
#gate {
  position: fixed; inset: 0; z-index: 9999;
  background: linear-gradient(135deg, #0f1e38 0%, #152847 60%, #1a3a60 100%);
  display: flex; align-items: center; justify-content: center;
  font-family: 'Heebo', sans-serif; direction: rtl;
}
#gate::before {
  content: '';
  position: absolute; inset: 0;
  background: repeating-linear-gradient(-50deg, transparent, transparent 60px, rgba(255,255,255,0.012) 60px, rgba(255,255,255,0.012) 61px);
}
.gate-box {
  position: relative; z-index: 1;
  background: rgba(255,255,255,0.06);
  backdrop-filter: blur(20px);
  border: 1.5px solid rgba(255,255,255,0.15);
  border-radius: 24px;
  padding: 3rem 3rem 2.5rem;
  width: 100%; max-width: 400px;
  box-shadow: 0 24px 80px rgba(0,0,0,0.4);
  text-align: center;
}
.gate-logo {
  width: 60px; height: 60px; border-radius: 16px;
  background: rgba(255,255,255,0.12);
  border: 1.5px solid rgba(255,255,255,0.2);
  display: flex; align-items: center; justify-content: center;
  font-size: 1.7rem; margin: 0 auto 1.4rem;
}
.gate-title {
  font-family: 'Playfair Display', serif;
  font-size: 1.5rem; color: #fff; font-weight: 700; margin-bottom: 0.3rem;
}
.gate-sub { font-size: 0.78rem; color: rgba(255,255,255,0.45); margin-bottom: 2rem; letter-spacing: 0.5px; }
.gate-label { display: block; font-size: 0.72rem; font-weight: 700; letter-spacing: 1.5px; text-transform: uppercase; color: rgba(255,255,255,0.45); text-align: right; margin-bottom: 0.5rem; }
.gate-input {
  width: 100%; padding: 0.85rem 1.1rem;
  border-radius: 12px;
  border: 1.5px solid rgba(255,255,255,0.18);
  background: rgba(255,255,255,0.08);
  color: #fff; font-family: 'Heebo', sans-serif; font-size: 1rem;
  outline: none; transition: border-color 0.2s, background 0.2s;
  text-align: right; letter-spacing: 2px;
  margin-bottom: 1.2rem;
}
.gate-input:focus { border-color: rgba(255,255,255,0.45); background: rgba(255,255,255,0.12); }
.gate-input.shake { animation: shake 0.4s ease; border-color: #ef4444; }
.gate-btn {
  width: 100%; padding: 0.9rem;
  border-radius: 12px; border: none;
  background: #fff; color: #152847;
  font-family: 'Heebo', sans-serif; font-size: 0.95rem; font-weight: 800;
  cursor: pointer; transition: all 0.2s;
  box-shadow: 0 4px 20px rgba(0,0,0,0.25);
}
.gate-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 28px rgba(0,0,0,0.3); }
.gate-btn:active { transform: translateY(0); }
.gate-err {
  margin-top: 1rem; font-size: 0.78rem; color: #f87171; font-weight: 600;
  min-height: 1.2em; transition: opacity 0.2s;
}
.gate-conf {
  margin-top: 1.5rem; font-size: 0.68rem; color: rgba(255,255,255,0.25);
  letter-spacing: 1px; text-transform: uppercase;
  display: flex; align-items: center; justify-content: center; gap: 0.4rem;
}
@keyframes shake {
  0%,100%{transform:translateX(0)} 20%{transform:translateX(-8px)} 40%{transform:translateX(8px)} 60%{transform:translateX(-5px)} 80%{transform:translateX(5px)}
}
@keyframes fadeOut {
  to { opacity: 0; pointer-events: none; }
}
</style>

<script>
// SHA-256 hash of "o12345" â€” password never stored in plain text
const HASH = '0555778e15e14e006a88a8593fb17650d29ced7eb43c08b40c801791e4c42ef7';

async function sha256(str) {
  const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(str));
  return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,'0')).join('');
}

async function checkPassword() {
  const input = document.getElementById('pwInput');
  const err   = document.getElementById('pwErr');
  const val   = input.value.trim();
  if (!val) return;

  const hash = await sha256(val);
  if (hash === HASH) {
    document.getElementById('gate').style.animation = 'fadeOut 0.5s ease forwards';
    setTimeout(() => document.getElementById('gate').remove(), 500);
  } else {
    err.textContent = 'âŒ ×¡×™×¡××” ×©×’×•×™×” â€” × ×¡×” ×©×•×‘';
    input.classList.add('shake');
    input.value = '';
    setTimeout(() => input.classList.remove('shake'), 400);
  }
}

document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('pwInput').addEventListener('keydown', e => {
    if (e.key === 'Enter') checkPassword();
    document.getElementById('pwErr').textContent = '';
  });
});
</script>
<style>
:root {
  --navy:  #152847;
  --navy2: #1e3a5f;
  --bg:    #f2f5fb;
  --white: #ffffff;
  --border:#e0e8f5;
  --text:  #111827;
  --text2: #374151;
  --text3: #6b7280;
  --text4: #9ca3af;
  --c-dr: #3b6fd4;
  --c-em: #7c3aed;
  --c-co: #0891b2;
  --c-vm: #d97706;
  --c-pr: #059669;
  --c-lo: #dc2626;
  --radius: 16px;
  --shadow: 0 1px 4px rgba(21,40,71,0.07), 0 6px 24px rgba(21,40,71,0.07);
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: 'Heebo', sans-serif; background: var(--bg); color: var(--text); direction: rtl; min-height: 100vh; }

/* TOP BAND */
.top-band {
  background: linear-gradient(130deg, #152847 0%, #1e3a5f 60%, #1a4a72 100%);
  padding: 1.5rem 2.5rem 2rem;
  position: relative; overflow: hidden;
}
.top-band::before {
  content: '';
  position: absolute; inset: 0;
  background: repeating-linear-gradient(-50deg, transparent, transparent 50px, rgba(255,255,255,0.012) 50px, rgba(255,255,255,0.012) 51px);
}
.band-inner { position: relative; z-index: 1; max-width: 1300px; margin: 0 auto; }
.band-nav { display: flex; align-items: center; justify-content: space-between; margin-bottom: 2.5rem; }
.brand { display: flex; align-items: center; gap: 0.9rem; }
.brand-mk { width: 44px; height: 44px; border-radius: 12px; background: rgba(255,255,255,0.13); border: 1.5px solid rgba(255,255,255,0.2); display: flex; align-items: center; justify-content: center; font-size: 1.3rem; }
.brand-nm { font-family: 'Playfair Display', serif; font-size: 1.4rem; color: #fff; }
.brand-sb { font-size: 0.62rem; color: rgba(255,255,255,0.45); text-transform: uppercase; letter-spacing: 2px; font-weight: 600; }
.nav-right { display: flex; gap: 0.6rem; align-items: center; }
.nav-pill { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.18); color: rgba(255,255,255,0.75); font-size: 0.74rem; font-weight: 600; padding: 0.38rem 1rem; border-radius: 50px; }
.nav-btn { background: #fff; color: var(--navy); font-family: 'Heebo', sans-serif; font-size: 0.78rem; font-weight: 800; padding: 0.42rem 1.2rem; border-radius: 50px; border: none; cursor: pointer; box-shadow: 0 2px 10px rgba(0,0,0,0.15); transition: all 0.18s; }
.nav-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 16px rgba(0,0,0,0.2); }

.band-title { text-align: center; margin-bottom: 2.5rem; }
.band-eye { font-size: 0.68rem; font-weight: 700; letter-spacing: 3px; text-transform: uppercase; color: rgba(255,255,255,0.45); margin-bottom: 0.5rem; }
.band-title h1 { font-family: 'Playfair Display', serif; font-size: 2.4rem; color: #fff; font-weight: 700; line-height: 1.15; letter-spacing: -0.3px; }
.band-title p { font-size: 0.88rem; color: rgba(255,255,255,0.6); margin-top: 0.55rem; }

/* FILTER BUTTONS */
.filter-row {
  display: flex; align-items: center; gap: 0.5rem; justify-content: center; flex-wrap: wrap;
}
.gr-label { font-size: 0.65rem; font-weight: 800; text-transform: uppercase; letter-spacing: 2px; color: var(--text4); padding-left: 0.8rem; border-left: 1.5px solid var(--border); }
.fb {
  padding: 0.44rem 1.15rem; border-radius: 50px;
  border: 1.5px solid var(--border);
  background: var(--bg); color: var(--text2);
  font-family: 'Heebo', sans-serif; font-size: 0.82rem; font-weight: 600;
  cursor: pointer; transition: all 0.16s; white-space: nowrap;
}
.fb:hover { background: #dce6f8; color: var(--navy); border-color: #b0c4e8; }
.fb.active { background: var(--navy); border-color: var(--navy); color: #fff; font-weight: 800; box-shadow: 0 2px 12px rgba(21,40,71,0.22); }

/* MAIN CARD */
.main-card {
  background: var(--white); border-radius: 22px;
  box-shadow: 0 4px 24px rgba(21,40,71,0.10);
  overflow: hidden;
}

/* CARD HEADER */
.card-head {
  display: flex; align-items: center; justify-content: space-between;
  padding: 1.5rem 2rem; border-bottom: 1px solid var(--border);
  flex-wrap: wrap; gap: 0.8rem;
  background: linear-gradient(135deg, #f8faff 0%, #fff 100%);
}
.card-head-left h2 { font-size: 1.05rem; font-weight: 800; color: var(--navy); }
.card-head-left p { font-size: 0.74rem; color: var(--text3); margin-top: 0.15rem; }
.legend { display: flex; gap: 1.2rem; flex-wrap: wrap; align-items: center; }
.leg { display: flex; align-items: center; gap: 0.45rem; font-size: 0.75rem; font-weight: 600; color: var(--text2); }
.lsq { width: 11px; height: 11px; border-radius: 3px; flex-shrink: 0; }

/* CHART AREA */
.chart-area { padding: 1.8rem 2rem; display: grid; grid-template-columns: 1.6fr 1fr; gap: 1.5rem; align-items: start; }
@media(max-width: 900px) { .chart-area { grid-template-columns: 1fr; } }
.chart-wrap { position: relative; height: 380px; }
.pie-wrap { position: relative; height: 380px; }
.pie-box { background: var(--bg); border: 1px solid var(--border); border-radius: 14px; padding: 1.3rem; }
.pie-title { font-size: 0.82rem; font-weight: 800; color: var(--navy); margin-bottom: 0.2rem; }
.pie-sub { font-size: 0.7rem; color: var(--text3); margin-bottom: 1rem; }

/* SUMMARY ROW (mini KPIs under chart) */
.mini-kpis {
  display: flex; gap: 1px; border-top: 1px solid var(--border);
  background: var(--border);
}
.mk {
  flex: 1; background: var(--white); padding: 1rem 1.3rem;
  display: flex; flex-direction: column; gap: 0.2rem;
  transition: background 0.13s;
}
.mk:hover { background: #f8faff; }
.mk-lbl { font-size: 0.65rem; font-weight: 800; text-transform: uppercase; letter-spacing: 0.8px; color: var(--text4); }
.mk-val { font-size: 1.15rem; font-weight: 900; color: var(--text); letter-spacing: -0.3px; }
.mk-pct { font-size: 0.72rem; font-weight: 700; }

/* TABLE */
.table-section { padding: 2rem; }
.ts-head { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; flex-wrap: wrap; gap: 0.5rem; }
.ts-title { font-size: 0.9rem; font-weight: 800; color: var(--navy); }
.ts-sub { font-size: 0.72rem; color: var(--text3); margin-top: 0.1rem; }

.tbl-box { border: 1.5px solid var(--border); border-radius: 14px; overflow: hidden; }
table { width: 100%; border-collapse: collapse; }
thead tr { background: var(--navy); }
th {
  padding: 0.82rem 1rem; text-align: right;
  font-size: 0.67rem; font-weight: 700; letter-spacing: 1px; text-transform: uppercase;
  color: rgba(255,255,255,0.7); white-space: nowrap;
}
th.tc { text-align: center; }
tbody tr { border-bottom: 1px solid var(--border); transition: background 0.12s; }
tbody tr:last-child { border-bottom: none; }
tbody tr:hover { background: #f0f5ff; }
td { padding: 0.82rem 1rem; font-size: 0.82rem; white-space: nowrap; vertical-align: middle; }

.t-name { display: flex; align-items: center; gap: 0.5rem; font-weight: 700; color: var(--text); }
.t-dot { width: 9px; height: 9px; border-radius: 50%; flex-shrink: 0; }
.t-num { text-align: left; font-variant-numeric: tabular-nums; color: var(--text2); font-weight: 600; }
.tc { text-align: center; }

/* Inline bar */
.ibar-wrap { display: flex; align-items: center; gap: 0.7rem; min-width: 180px; }
.ibar-track { flex: 1; height: 8px; border-radius: 4px; background: #e5eaf5; overflow: hidden; display: flex; }
.ibar-seg { height: 100%; transition: width 0.6s ease; }

.chip { display: inline-flex; align-items: center; padding: 0.2rem 0.7rem; border-radius: 50px; font-size: 0.72rem; font-weight: 800; }
.cg { background: #ecfdf5; color: #065f46; }
.cw { background: #fffbeb; color: #92400e; }
.cb { background: #fef2f2; color: #991b1b; }

/* INSIGHT BOX */
.insights { margin: 0 2rem 2rem; }
.insight-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 1rem; }
@media(max-width:800px){ .insight-grid{grid-template-columns:1fr} }
.insight-card {
  border-radius: 12px; padding: 1.1rem 1.2rem;
  border: 1.5px solid transparent; display: flex; gap: 0.8rem; align-items: flex-start;
}
.ic-icon { font-size: 1.3rem; flex-shrink: 0; margin-top: 0.05rem; }
.ic-title { font-size: 0.78rem; font-weight: 800; margin-bottom: 0.2rem; }
.ic-body { font-size: 0.73rem; line-height: 1.55; }
.ic-green { background: #f0fdf4; border-color: #bbf7d0; color: #14532d; }
.ic-red { background: #fef2f2; border-color: #fecaca; color: #7f1d1d; }
.ic-blue { background: #eff6ff; border-color: #bfdbfe; color: #1e3a8a; }

footer { text-align: center; padding: 1.8rem 0 1.2rem; color: var(--text4); font-size: 0.7rem; border-top: 1px solid var(--border); margin: 0 2rem; }

/* â”€â”€â”€ BRANCH COMPARISON â”€â”€â”€ */
.comparison-section {
  margin: 0 2rem 0;
  border-top: 1px solid var(--border);
  padding: 2rem 0 2rem;
}
.comp-head {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 1.5rem; flex-wrap: wrap; gap: 0.8rem;
}
.comp-title { font-size: 1rem; font-weight: 800; color: var(--navy); }
.comp-sub   { font-size: 0.72rem; color: var(--text3); margin-top: 0.15rem; }
.comp-tabs  { display: flex; gap: 0.4rem; flex-wrap: wrap; }
.ctab {
  padding: 0.38rem 1rem; border-radius: 50px; border: 1px solid var(--border);
  background: var(--bg); color: var(--text3);
  font-family: 'Heebo', sans-serif; font-size: 0.78rem; font-weight: 600;
  cursor: pointer; transition: all 0.15s;
}
.ctab:hover { border-color: var(--navy); color: var(--navy); }
.ctab.active { background: var(--navy); border-color: var(--navy); color: #fff; }

/* Branch cards */
.comp-grid {
  display: grid; grid-template-columns: repeat(5, 1fr); gap: 1rem; margin-bottom: 1.5rem;
}
@media(max-width:1100px){ .comp-grid{ grid-template-columns: repeat(3,1fr) } }
@media(max-width:640px){  .comp-grid{ grid-template-columns: repeat(2,1fr) } }

.comp-card {
  border-radius: 14px; border: 1.5px solid var(--border);
  background: var(--white); padding: 1.2rem 1.1rem;
  box-shadow: var(--shadow); position: relative; overflow: hidden;
  transition: transform 0.18s, box-shadow 0.18s;
}
.comp-card:hover { transform: translateY(-3px); box-shadow: var(--shadow-lg); }
.comp-card::before {
  content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px;
  background: var(--cc);
}
.cc-name { font-size: 0.78rem; font-weight: 800; color: var(--text); margin-bottom: 0.7rem; display: flex; align-items: center; gap: 0.45rem; }
.cc-dot  { width: 9px; height: 9px; border-radius: 50%; background: var(--cc); flex-shrink: 0; }
.cc-big  { font-size: 1.7rem; font-weight: 900; letter-spacing: -0.5px; color: var(--ccol); line-height: 1; }
.cc-lbl  { font-size: 0.65rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.8px; color: var(--text4); margin-top: 0.3rem; }
.cc-bar-wrap { margin-top: 0.8rem; }
.cc-bar-track { height: 6px; border-radius: 3px; background: #e8eef5; overflow: hidden; }
.cc-bar-fill  { height: 100%; border-radius: 3px; background: var(--cc); transition: width 0.7s cubic-bezier(.4,0,.2,1); }
.cc-bar-sub   { font-size: 0.67rem; color: var(--text4); margin-top: 0.3rem; font-weight: 500; }
.cc-rank {
  position: absolute; top: 0.7rem; left: 0.8rem;
  width: 20px; height: 20px; border-radius: 50%;
  background: var(--cc); color: #fff;
  font-size: 0.65rem; font-weight: 900;
  display: flex; align-items: center; justify-content: center;
}

/* Comparison chart */
.comp-chart-wrap {
  background: var(--bg); border: 1px solid var(--border);
  border-radius: 14px; padding: 1.4rem 1.5rem;
}

</style>
</head>
<body>

<!-- PASSWORD OVERLAY -->
<div id="gate">
  <div class="gate-box">
    <div class="gate-logo">ğŸ¥</div>
    <div class="gate-title">MedNet Analytics</div>
    <div class="gate-sub">INVESTOR PORTAL â€¢ CONFIDENTIAL</div>
    <label class="gate-label" for="pwInput">×¡×™×¡××”</label>
    <input id="pwInput" class="gate-input" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="off" autofocus />
    <button class="gate-btn" onclick="checkPassword()">×›× ×™×¡×” ×œ××¢×¨×›×ª â†’</button>
    <div class="gate-err" id="pwErr"></div>
    <div class="gate-conf">ğŸ”’ ××•×¦×¤×Ÿ ×•×××•×‘×˜×—</div>
  </div>
</div>

<div class="top-band">
  <div class="band-inner">
    <!-- NAV -->
    <div class="band-nav">
      <div class="brand">
        <div class="brand-mk">ğŸ¥</div>
        <div>
          <div class="brand-nm">MedNet</div>
          <div class="brand-sb">Investor Platform</div>
        </div>
      </div>
      <div class="nav-right">
        <div class="nav-pill">ğŸ“… ××•×’×³ 2025 â€” ×™× ×•×³ 2026</div>
        <button class="nav-btn">â¬‡ ×™×™×¦× PDF</button>
      </div>
    </div>

    <!-- TITLE -->
    <div class="band-title">
      <div class="band-eye">Revenue Distribution Analysis</div>
      <h1>×”×ª×¤×œ×’×•×ª ×”×›× ×¡×•×ª ×œ×¤×™ ×§×˜×’×•×¨×™×”</h1>
      <p>×‘×—×¨ ×§×‘×•×¦×” ×œ×¦×¤×™×™×” ×‘×¤×™×¨×•×˜ â€” ×›×œ ×¢××•×“×” = 100% ××”×›× ×¡×•×ª ××•×ª×• ×¡× ×™×£/××—×œ×§×”</p>
    </div>
  </div>
</div>

<!-- FILTER BAR â€” outside the blue band -->
<div style="background:#fff; border-bottom:1px solid #e0e8f5; box-shadow:0 2px 8px rgba(21,40,71,0.06);">
  <div style="max-width:1300px;margin:0 auto;padding:0.9rem 2.5rem;">
    <div class="filter-row">
      <button class="fb active" onclick="setGroup('network', this)">ğŸŒ ×›×œ ×”×¨×©×ª</button>
      <div class="gr-label">×¡× ×™×¤×™×</div>
      <button class="fb" onclick="setGroup('kfar', this)">×›×¤×¨ ×¡×‘×</button>
      <button class="fb" onclick="setGroup('rehovot', this)">×¨×—×•×‘×•×ª</button>
      <button class="fb" onclick="setGroup('bs', this)">×‘××¨ ×©×‘×¢</button>
      <button class="fb" onclick="setGroup('haifa', this)">×—×™×¤×”</button>
      <button class="fb" onclick="setGroup('motzkin', this)">××•×¦×§×™×Ÿ</button>
      <div class="gr-label">××—×œ×§×•×ª</div>
      <button class="fb" onclick="setGroup('depts', this)">×›×œ ×”××—×œ×§×•×ª</button>
      <button class="fb" onclick="setGroup('chirum', this)">×—×™×¨×•×</button>
      <button class="fb" onclick="setGroup('neuro', this)">× ×•×™×¨×•×œ×•×’×™×”</button>
      <button class="fb" onclick="setGroup('imaging', this)">×”×“××™×”</button>
      <button class="fb" onclick="setGroup('surgery', this)">×›×™×¨×•×¨×’×™×”</button>
      <button class="fb" onclick="setGroup('cardio', this)">×§×¨×“×™×•×œ×•×’×™×”</button>
      <button class="fb" onclick="setGroup('onco', this)">××•× ×§×•×œ×•×’×™×”</button>
      <button class="fb" onclick="setGroup('anest', this)">×”×¨×“××”</button>
    </div>
  </div>
</div>

<!-- MAIN CARD -->
<div style="padding: 1.5rem 2rem 0; max-width: 1350px; margin: 0 auto;">
<div class="main-card">

  <!-- CARD HEADER -->
  <div class="card-head">
    <div class="card-head-left">
      <h2 id="chartTitle">×›×œ ×”×¨×©×ª â€” ×¡× ×™×¤×™×</h2>
      <p id="chartSub">×”×ª×¤×œ×’×•×ª 100% ×©×œ ×”×›× ×¡×•×ª ×œ×¤×™ ×§×˜×’×•×¨×™×™×ª ×¢×œ×•×ª ×•×ª×¨×•××” ×™×©×™×¨×”</p>
    </div>
    <div class="legend">
      <div class="leg"><span class="lsq" style="background:var(--c-dr)"></span>×©×›×¨ ×¨×•×¤××™×</div>
      <div class="leg"><span class="lsq" style="background:var(--c-em)"></span>×©×›×¨ ×¢×•×‘×“×™×</div>
      <div class="leg"><span class="lsq" style="background:var(--c-co)"></span>×§×‘×œ× ×™ ××©× ×”</div>
      <div class="leg"><span class="lsq" style="background:var(--c-vm)"></span>×•×˜××¨×§×˜ ğŸ¾</div>
      <div class="leg"><span class="lsq" style="background:var(--c-pr)"></span>×ª×¨×•××” ×™×©×™×¨×” âœ…</div>
      <div class="leg"><span class="lsq" style="background:var(--c-lo)"></span>×”×¤×¡×“ ğŸ”´</div>
    </div>
  </div>

  <!-- CHART -->
  <div class="chart-area">
    <div class="chart-wrap"><canvas id="mainChart"></canvas></div>
    <div class="pie-box">
      <div class="pie-title">â¬¤ ×”×ª×¤×œ×’×•×ª ×¢×œ×•×™×•×ª</div>
      <div class="pie-sub" id="pieSub">×¡×”×´×› ×”×§×‘×•×¦×” ×”× ×‘×—×¨×ª</div>
      <div class="pie-wrap"><canvas id="pieChart"></canvas></div>
    </div>
  </div>

  <!-- MINI KPIs -->
  <div class="mini-kpis" id="miniKpis"></div>

  <!-- TABLE -->
  <div class="table-section">
    <div class="ts-head">
      <div>
        <div class="ts-title">×˜×‘×œ×ª × ×ª×•× ×™× ××¤×•×¨×˜×ª</div>
        <div class="ts-sub">×¡×”×´×› 6 ×—×•×“×©×™× â€¢ ×œ×—×¥ ×¢×œ ×©×•×¨×” ×œ×¤×™×¨×•×˜</div>
      </div>
    </div>
    <div class="tbl-box">
      <div style="overflow-x:auto">
        <table>
          <thead><tr>
            <th>×©×</th>
            <th>×”×›× ×¡×•×ª</th>
            <th class="tc">ğŸ‘¨â€âš•ï¸ ×©×›×¨ ×¨×•×¤××™×</th>
            <th class="tc">ğŸ‘¥ ×©×›×¨ ×¢×•×‘×“×™×</th>
            <th class="tc">ğŸ¾ ×•×˜××¨×§×˜</th>
            <th class="tc">ğŸ”§ ×§×‘×œ× ×™ ××©× ×”</th>
            <th>×”×ª×¤×œ×’×•×ª ×¢×œ×•×™×•×ª</th>
            <th class="tc">ğŸ’š ×ª×¨×•××” ×™×©×™×¨×”</th>
            <th class="tc">××¨×•×•×— %</th>
          </tr></thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- INSIGHTS -->
  <div class="insights">
    <div class="insight-grid" id="insightGrid"></div>
  </div>

  <!-- BRANCH COMPARISON -->
  <div class="comparison-section">
    <div class="comp-head">
      <div>
        <div class="comp-title">ğŸ“Š ×”×©×•×•××ª ×‘×™×¦×•×¢×™× â€” ×›×œ ×”×¡× ×™×¤×™×</div>
        <div class="comp-sub">×¡×”×´×› 6 ×—×•×“×©×™× â€¢ ××•×’×³ 2025 â€“ ×™× ×•×³ 2026</div>
      </div>
      <div class="comp-tabs" id="compTabs">
        <button class="ctab active" onclick="setCompView('revenue',this)">×”×›× ×¡×•×ª</button>
        <button class="ctab" onclick="setCompView('margin',this)">××¨×•×•×— %</button>
        <button class="ctab" onclick="setCompView('contrib',this)">×ª×¨×•××” ×™×©×™×¨×”</button>
        <button class="ctab" onclick="setCompView('dr',this)">×©×›×¨ ×¨×•×¤××™×</button>
      </div>
    </div>
    <div class="comp-grid" id="compGrid"></div>
    <div class="comp-chart-wrap">
      <canvas id="compChart" height="90"></canvas>
    </div>
  </div>

  <footer>MedNet Analytics â€¢ Book3.xlsx â€¢ ××•×’×³ 2025 â€“ ×™× ×•×³ 2026 â€¢ Confidential</footer>
</div>
</div>

<script>
// â”€â”€â”€ DATA â”€â”€â”€
const ALL = {
  // Branches
  '×›×¤×¨ ×¡×‘×':  { type:'branch', color:'#0891b2', rev:22198992, dr:4939304, em:5113394, co:224847, vm:1150990, cont:10770457 },
  '×¨×—×•×‘×•×ª':   { type:'branch', color:'#7c3aed', rev:3901077,  dr:2327071, em:1398184, co:0,      vm:344882,  cont:-169060  },
  '×‘××¨ ×©×‘×¢':  { type:'branch', color:'#059669', rev:2522324,  dr:722968,  em:418245,  co:0,      vm:341603,  cont:1039508  },
  '×—×™×¤×”':     { type:'branch', color:'#0284c7', rev:4948841,  dr:2318511, em:997865,  co:0,      vm:474974,  cont:1157491  },
  '××•×¦×§×™×Ÿ':   { type:'branch', color:'#d97706', rev:595550,   dr:90554,   em:272195,  co:0,      vm:55292,   cont:177510   },
  // Depts
  '×—×™×¨×•×':      { type:'dept', color:'#ef4444', rev:9124098, dr:2203685, em:2407961, co:0,      vm:916009, cont:3596444  },
  '× ×•×™×¨×•×œ×•×’×™×”': { type:'dept', color:'#ec4899', rev:3514569, dr:510624,  em:443575,  co:174347, vm:83800,  cont:2302224  },
  '×”×“××™×”':      { type:'dept', color:'#14b8a6', rev:3036425, dr:432437,  em:534940,  co:50500,  vm:22508,  cont:1996039  },
  '×›×™×¨×•×¨×’×™×”':   { type:'dept', color:'#a855f7', rev:3513439, dr:428538,  em:680370,  co:0,      vm:128673, cont:2275858  },
  '×§×¨×“×™×•×œ×•×’×™×”': { type:'dept', color:'#f43f5e', rev:898692,  dr:392341,  em:38958,   co:0,      vm:0,      cont:299595  },
  '××•× ×§×•×œ×•×’×™×”': { type:'dept', color:'#f97316', rev:1121066, dr:626712,  em:0,       co:0,      vm:0,      cont:495000  },
  '×”×¨×“××”':      { type:'dept', color:'#84cc16', rev:610372,  dr:251563,  em:19424,   co:0,      vm:0,      cont:339403  },

  // Monthly dept data
  '×—×™×¨×•×_monthly': { months: {
    dr: [0, 443110, 415386, 398468, 524730, 421991],
    em: [0, 441633, 570103, 442097, 494877, 459251],
    co: [0, 0, 0, 0, 0, 0],
    vm: [0, 0, 232255, 302662, 82318, 298774],
    rev:[1526302, 1456678, 1598972, 1545136, 1429007, 1568003],
    cont:[1526302, 571935, 381228, 401909, 327082, 387988],
  }},
  '× ×•×™×¨×•×œ×•×’×™×”_monthly': { months: {
    dr: [0, 121651, 82232, 95035, 104618, 107088],
    em: [0, 72007, 85481, 91575, 93961, 100551],
    co: [0, 0, 40339, 39746, 43839, 50423],
    vm: [0, 0, 25750, 15569, 26108, 16373],
    rev:[764258, 434803, 475744, 805726, 550269, 483769],
    cont:[764258, 241145, 241942, 563801, 281744, 209334],
  }},
  '×”×“××™×”_monthly': { months: {
    dr: [0, 80367, 87452, 80906, 100337, 83375],
    em: [0, 104136, 110676, 103929, 107995, 108204],
    co: [0, 0, 13500, 10500, 12750, 13750],
    vm: [0, 0, 5609, 5777, 3228, 7894],
    rev:[473890, 478567, 464873, 531811, 560003, 527281],
    cont:[473890, 294064, 247636, 330699, 335693, 314057],
  }},
  '×›×™×¨×•×¨×’×™×”_monthly': { months: {
    dr: [0, 79061, 102525, 79509, 79626, 87817],
    em: [0, 130249, 134458, 160344, 142842, 112477],
    co: [0, 0, 0, 0, 0, 0],
    vm: [0, 0, 5432, 35296, 25613, 62332],
    rev:[561458, 443381, 592931, 639583, 620246, 655840],
    cont:[561458, 234071, 350516, 364434, 372165, 393214],
  }},
  '×§×¨×“×™×•×œ×•×’×™×”_monthly': { months: {
    dr: [0, 31568, 70731, 76089, 106568, 107385],
    em: [0, 7949, 7525, 7927, 8758, 6799],
    co: [0, 0, 0, 0, 0, 0],
    vm: [0, 0, 0, 0, 0, 0],
    rev:[167715, 93928, 111236, 164369, 177806, 183636],
    cont:[167715, 54411, 32979, 80353, 62480, 69452],
  }},
  '××•× ×§×•×œ×•×’×™×”_monthly': { months: {
    dr: [0, 0, 142356, 160730, 180991, 142634],
    em: [0, 0, 0, 0, 0, 0],
    co: [0, 0, 0, 0, 0, 0],
    vm: [0, 0, 0, 0, 0, 0],
    rev:[156231, 173355, 165306, 218676, 235970, 172527],
    cont:[156231, 173355, 22950, 57947, 54980, 29893],
  }},
  '×”×¨×“××”_monthly': { months: {
    dr: [0, 35048, 51466, 59215, 54094, 51742],
    em: [0, 3454, 2313, 4807, 3773, 5077],
    co: [0, 0, 0, 0, 0, 0],
    vm: [0, 0, 0, 0, 0, 0],
    rev:[64958, 46517, 103983, 133347, 136186, 125381],
    cont:[64958, 8015, 50204, 69325, 78319, 68562],
  }},
  '×›×¤×¨ ×¡×‘×_monthly': { months: {
    dr: [0,790805,978381,975545,1175464,1019109],
    em: [0,944588,1086804,998550,1053788,1029664],
    co: [0,0,53839,50246,56589,64173],
    vm: [0,0,269046,359304,137267,385373],
    rev:[3771427,3190723,3589999,4101214,3776818,3768811],
    cont:[3771427,1455330,1201929,1717569,1353710,1270492],
  }},
  '×¨×—×•×‘×•×ª_monthly': { months: {
    dr: [425375,356716,362125,356392,461400,365063],
    em: [231167,227730,241617,230396,250022,217252],
    co: [0,0,0,0,0,0],
    vm: [0,0,85374,86514,86480,86514],
    rev:[0,586379,870220,850423,820875,773180],
    cont:[-656541,1933,181104,177120,22973,104351],
  }},
  '×‘××¨ ×©×‘×¢_monthly': { months: {
    dr: [117201,115677,107026,99366,138179,145519],
    em: [67982,65735,69339,69932,75318,69939],
    co: [0,0,0,0,0,0],
    vm: [0,50127,85409,61107,83853,61107],
    rev:[423525,392875,375400,421733,469620,439171],
    cont:[238341,161335,113626,191329,172271,162606],
  }},
  '×—×™×¤×”_monthly': { months: {
    dr: [295955,304381,448146,429847,455672,384510],
    em: [149925,160972,210698,153073,169438,153759],
    co: [0,0,0,0,0,0],
    vm: [0,0,113036,133788,115114,113036],
    rev:[432033,869412,886831,872897,880342,1007326],
    cont:[-13847,404059,114951,156189,140118,356021],
  }},
  '××•×¦×§×™×Ÿ_monthly': { months: {
    dr: [14949,10496,15968,16105,19462,13574],
    em: [38651,32583,35213,38324,74417,53007],
    co: [0,0,0,0,0,0],
    vm: [0,9012,9686,11929,14979,9686],
    rev:[49908,94246,108673,129999,85021,127703],
    cont:[-3692,42155,47806,63641,-23837,51437],
  }},
};

const MONTHS = ['××•×’×³ 25','×¡×¤×˜×³ 25','××•×§×³ 25','× ×•×‘×³ 25','×“×¦××³ 25','×™× ×•×³ 26'];

const GROUPS = {
  network:  { title:'×›×œ ×”×¨×©×ª â€” ×¡× ×™×¤×™×', keys:['×›×¤×¨ ×¡×‘×','×¨×—×•×‘×•×ª','×‘××¨ ×©×‘×¢','×—×™×¤×”','××•×¦×§×™×Ÿ'] },
  kfar:     { title:'×›×¤×¨ ×¡×‘× â€” ×œ×¤×™ ×—×•×“×©', monthly:'×›×¤×¨ ×¡×‘×' },
  rehovot:  { title:'×¨×—×•×‘×•×ª â€” ×œ×¤×™ ×—×•×“×©',  monthly:'×¨×—×•×‘×•×ª' },
  bs:       { title:'×‘××¨ ×©×‘×¢ â€” ×œ×¤×™ ×—×•×“×©', monthly:'×‘××¨ ×©×‘×¢' },
  haifa:    { title:'×—×™×¤×” â€” ×œ×¤×™ ×—×•×“×©',    monthly:'×—×™×¤×”' },
  motzkin:  { title:'××•×¦×§×™×Ÿ â€” ×œ×¤×™ ×—×•×“×©',  monthly:'××•×¦×§×™×Ÿ' },
  depts:    { title:'××—×œ×§×•×ª ×›×¤×¨ ×¡×‘× â€” ×›×•×œ×Ÿ', keys:['×—×™×¨×•×','× ×•×™×¨×•×œ×•×’×™×”','×”×“××™×”','×›×™×¨×•×¨×’×™×”','×§×¨×“×™×•×œ×•×’×™×”','××•× ×§×•×œ×•×’×™×”','×”×¨×“××”'] },
  chirum:   { title:'×—×™×¨×•× â€” ×œ×¤×™ ×—×•×“×©',      monthly:'×—×™×¨×•×' },
  neuro:    { title:'× ×•×™×¨×•×œ×•×’×™×” â€” ×œ×¤×™ ×—×•×“×©', monthly:'× ×•×™×¨×•×œ×•×’×™×”' },
  imaging:  { title:'×”×“××™×” â€” ×œ×¤×™ ×—×•×“×©',      monthly:'×”×“××™×”' },
  surgery:  { title:'×›×™×¨×•×¨×’×™×” â€” ×œ×¤×™ ×—×•×“×©',   monthly:'×›×™×¨×•×¨×’×™×”' },
  cardio:   { title:'×§×¨×“×™×•×œ×•×’×™×” â€” ×œ×¤×™ ×—×•×“×©', monthly:'×§×¨×“×™×•×œ×•×’×™×”' },
  onco:     { title:'××•× ×§×•×œ×•×’×™×” â€” ×œ×¤×™ ×—×•×“×©', monthly:'××•× ×§×•×œ×•×’×™×”' },
  anest:    { title:'×”×¨×“××” â€” ×œ×¤×™ ×—×•×“×©',       monthly:'×”×¨×“××”' },
};

let currentGroup = 'network';
let chart = null;
let pieChart = null;

const fmt = n => {
  if (n===null||isNaN(n)) return 'â€”';
  const a = Math.abs(n);
  if (a>=1e6) return (n<0?'-':'')+'â‚ª'+(a/1e6).toFixed(2)+'M';
  if (a>=1e3) return (n<0?'-':'')+'â‚ª'+(a/1e3).toFixed(0)+'K';
  return (n<0?'-':'')+'â‚ª'+a.toFixed(0);
};
const fmtPct = (v,r) => r>0 ? (v/r*100).toFixed(1)+'%' : 'â€”';
const pn = (v,r) => r>0 ? v/r*100 : 0;
const sum = arr => arr.reduce((a,b)=>a+(b||0),0);

function buildData(gKey) {
  const g = GROUPS[gKey];
  if (g.monthly) {
    const m = ALL[g.monthly + '_monthly'].months;
    return MONTHS.map((mo, i) => ({
      name: mo, color: ALL[g.monthly].color,
      rev: m.rev[i], dr: m.dr[i], em: m.em[i], co: m.co[i], vm: m.vm[i], cont: m.cont[i]
    }));
  }
  return g.keys.map(k => ({ name: k, ...ALL[k] }));
}

function setGroup(gKey, el) {
  currentGroup = gKey;
  document.querySelectorAll('.fb').forEach(b => b.classList.remove('active'));
  if (el) el.classList.add('active');
  renderAll();
}

function renderAll() {
  const g = GROUPS[currentGroup];
  const rows = buildData(currentGroup);
  document.getElementById('chartTitle').textContent = g.title;
  renderChart(rows);
  renderPieChart(rows);
  renderMiniKpis(rows);
  renderTable(rows);
  renderInsights(rows);
}

function renderChart(rows) {
  if (chart) chart.destroy();
  const ctx = document.getElementById('mainChart').getContext('2d');

  // Build 100% stacked data
  const labels = rows.map(r => r.name);
  const colors = rows.map(r => r.color);

  const mkDs = (key, label, color) => ({
    label,
    data: rows.map(r => {
      if (!r.rev || r.rev === 0) return 0;
      return Math.max(0, parseFloat((r[key]/r.rev*100).toFixed(2)));
    }),
    backgroundColor: color,
    stack: 'stack',
  });

  // Loss segment
  const lossDs = {
    label: '×”×¤×¡×“',
    data: rows.map(r => {
      if (!r.rev || r.rev === 0) return 0;
      return r.cont < 0 ? parseFloat((Math.abs(r.cont)/r.rev*100).toFixed(2)) : 0;
    }),
    backgroundColor: '#dc2626',
    stack: 'stack',
  };

  const contDs = {
    label: '×ª×¨×•××” ×™×©×™×¨×”',
    data: rows.map(r => {
      if (!r.rev || r.rev === 0) return 0;
      return r.cont > 0 ? parseFloat((r.cont/r.rev*100).toFixed(2)) : 0;
    }),
    backgroundColor: '#059669',
    stack: 'stack',
  };

  chart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels,
      datasets: [
        mkDs('dr', '×©×›×¨ ×¨×•×¤××™×', '#3b6fd4'),
        mkDs('em', '×©×›×¨ ×¢×•×‘×“×™×', '#7c3aed'),
        mkDs('co', '×§×‘×œ× ×™ ××©× ×”', '#0891b2'),
        mkDs('vm', '×•×˜××¨×§×˜', '#d97706'),
        contDs,
        lossDs,
      ]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: {
        legend: { display: false },
        tooltip: {
          rtl: true,
          backgroundColor: '#152847',
          titleColor: '#fff',
          bodyColor: 'rgba(255,255,255,0.82)',
          borderColor: 'rgba(255,255,255,0.1)',
          borderWidth: 1,
          padding: 13,
          callbacks: {
            title: items => items[0].label,
            label: c => {
              if (c.raw === 0) return null;
              const row = buildData(currentGroup)[c.dataIndex];
              const absVal = c.raw / 100 * row.rev;
              return ` ${c.dataset.label}: ${c.raw.toFixed(1)}%  (${fmt(absVal)})`;
            },
            afterBody: items => {
              const row = buildData(currentGroup)[items[0].dataIndex];
              return [``, `ğŸ“Š ×”×›× ×¡×•×ª: ${fmt(row.rev)}`];
            }
          }
        }
      },
      scales: {
        x: {
          stacked: true,
          ticks: { color: '#6b7280', font: { family: 'Heebo', size: 11 }, maxRotation: 0 },
          grid: { display: false },
        },
        y: {
          stacked: true,
          min: 0, max: 115,
          ticks: {
            color: '#6b7280', font: { family: 'Heebo', size: 11 },
            callback: v => v + '%',
            stepSize: 20,
          },
          grid: { color: '#f0f4fb' },
        }
      }
    }
  });
}

function renderMiniKpis(rows) {
  const totals = rows.reduce((acc, r) => {
    acc.rev  += r.rev  || 0;
    acc.dr   += r.dr   || 0;
    acc.em   += r.em   || 0;
    acc.vm   += r.vm   || 0;
    acc.co   += r.co   || 0;
    acc.cont += r.cont || 0;
    return acc;
  }, {rev:0, dr:0, em:0, vm:0, co:0, cont:0});

  const items = [
    { lbl:'×”×›× ×¡×•×ª ×¡×”×´×›',    val:fmt(totals.rev),  pct:'',                          c:'#152847' },
    { lbl:'×©×›×¨ ×¨×•×¤××™×',     val:fmt(totals.dr),   pct:fmtPct(totals.dr,totals.rev), c:'#3b6fd4' },
    { lbl:'×©×›×¨ ×¢×•×‘×“×™×',     val:fmt(totals.em),   pct:fmtPct(totals.em,totals.rev), c:'#7c3aed' },
    { lbl:'×•×˜××¨×§×˜',         val:fmt(totals.vm),   pct:fmtPct(totals.vm,totals.rev), c:'#d97706' },
    { lbl:'×§×‘×œ× ×™ ××©× ×”',     val:fmt(totals.co),   pct:fmtPct(totals.co,totals.rev), c:'#0891b2' },
    { lbl:'×ª×¨×•××” ×™×©×™×¨×”',    val:fmt(totals.cont), pct:fmtPct(totals.cont,totals.rev),c: totals.cont>=0?'#059669':'#dc2626' },
  ];
  document.getElementById('miniKpis').innerHTML = items.map(it => `
    <div class="mk">
      <div class="mk-lbl">${it.lbl}</div>
      <div class="mk-val" style="color:${it.c}">${it.val}</div>
      ${it.pct ? `<div class="mk-pct" style="color:${it.c}">${it.pct} ××”×›× ×¡×•×ª</div>` : ''}
    </div>
  `).join('');
}

function renderTable(rows) {
  let html = '';
  rows.forEach(r => {
    const mPct = r.rev > 0 ? r.cont/r.rev*100 : 0;
    const mClass = mPct >= 40 ? 'cg' : mPct >= 10 ? 'cw' : 'cb';
    const drPct = pn(r.dr,r.rev), emPct = pn(r.em,r.rev), vmPct = pn(r.vm,r.rev), coPct = pn(r.co,r.rev);
    const prPct = Math.max(0, pn(r.cont,r.rev));

    const cpill = (val, rev, c) => val
      ? `<div style="display:inline-flex;align-items:center;gap:0.3rem;padding:0.2rem 0.65rem;border-radius:50px;background:${c}18;color:${c};border:1px solid ${c}30;font-size:0.71rem;font-weight:700">
          ${fmt(val)}<span style="opacity:0.65">${fmtPct(val,rev)}</span>
        </div>`
      : `<span style="color:#d1d5db;font-size:0.72rem">â€”</span>`;

    html += `<tr>
      <td><div class="t-name"><span class="t-dot" style="background:${r.color}"></span>${r.name}</div></td>
      <td class="t-num" style="color:#152847;font-weight:800">${fmt(r.rev)}</td>
      <td class="tc">${cpill(r.dr, r.rev, '#3b6fd4')}</td>
      <td class="tc">${cpill(r.em, r.rev, '#7c3aed')}</td>
      <td class="tc">${cpill(r.vm, r.rev, '#d97706')}</td>
      <td class="tc">${cpill(r.co, r.rev, '#0891b2')}</td>
      <td>
        <div class="ibar-wrap">
          <div class="ibar-track">
            <div class="ibar-seg" style="width:${Math.min(drPct,100)}%;background:#3b6fd4"></div>
            <div class="ibar-seg" style="width:${Math.min(emPct,100)}%;background:#7c3aed"></div>
            <div class="ibar-seg" style="width:${Math.min(vmPct,100)}%;background:#d97706"></div>
            <div class="ibar-seg" style="width:${Math.min(coPct,100)}%;background:#0891b2"></div>
            <div class="ibar-seg" style="width:${Math.min(prPct,100)}%;background:#059669"></div>
          </div>
        </div>
      </td>
      <td class="tc">
        <div style="display:inline-flex;align-items:center;padding:0.2rem 0.65rem;border-radius:50px;background:${r.cont<0?'#fef2f2':'#ecfdf5'};color:${r.cont<0?'#991b1b':'#065f46'};border:1px solid ${r.cont<0?'#fecaca':'#a7f3d0'};font-size:0.71rem;font-weight:800">
          ${fmt(r.cont)}
        </div>
      </td>
      <td class="tc"><span class="chip ${mClass}">${mPct>=0?'+':''}${mPct.toFixed(1)}%</span></td>
    </tr>`;
  });
  document.getElementById('tbody').innerHTML = html;
}

function renderPieChart(rows) {
  if (pieChart) pieChart.destroy();
  const ctx = document.getElementById('pieChart').getContext('2d');

  // Sum all categories across visible rows
  const totals = rows.reduce((acc, r) => {
    acc.dr += r.dr || 0;
    acc.em += r.em || 0;
    acc.co += r.co || 0;
    acc.vm += r.vm || 0;
    acc.cont += Math.max(0, r.cont || 0);
    return acc;
  }, { dr:0, em:0, co:0, vm:0, cont:0 });

  const total = totals.dr + totals.em + totals.co + totals.vm + totals.cont;

  // Update subtitle
  document.getElementById('pieSub').textContent =
    `×¡×”×´×›: ${fmt(total)} â€¢ ${GROUPS[currentGroup].monthly ? '6 ×—×•×“×©×™×' : rows.length + ' ×™×—×™×“×•×ª'}`;

  pieChart = new Chart(ctx, {
    type: 'pie',
    data: {
      labels: ['×©×›×¨ ×¨×•×¤××™×', '×©×›×¨ ×¢×•×‘×“×™×', '×§×‘×œ× ×™ ××©× ×”', '×•×˜××¨×§×˜', '×ª×¨×•××” ×™×©×™×¨×”'],
      datasets: [{
        data: [totals.dr, totals.em, totals.co, totals.vm, totals.cont],
        backgroundColor: ['#3b6fd4', '#7c3aed', '#0891b2', '#d97706', '#059669'],
        borderColor: '#fff',
        borderWidth: 3,
        hoverOffset: 8,
      }]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: {
        legend: {
          position: 'bottom', rtl: true,
          labels: {
            color: '#374151', font: { family: 'Heebo', size: 11 },
            padding: 12, usePointStyle: true, pointStyleWidth: 9,
            filter: item => item.parsed > 0,
          }
        },
        tooltip: {
          rtl: true,
          backgroundColor: '#152847',
          titleColor: '#fff',
          bodyColor: 'rgba(255,255,255,0.82)',
          borderColor: 'rgba(255,255,255,0.1)',
          borderWidth: 1,
          padding: 12,
          callbacks: {
            label: c => {
              if (c.parsed === 0) return null;
              const pct = total > 0 ? (c.parsed / total * 100).toFixed(1) : 0;
              return ` ${c.label}: ${fmt(c.parsed)}  (${pct}%)`;
            }
          }
        }
      }
    }
  });
}

function renderInsights(rows) {
  // Find best, worst, and most investment-heavy
  const valid = rows.filter(r => r.rev > 0);
  const byMargin = [...valid].sort((a,b) => b.cont/b.rev - a.cont/a.rev);
  const best = byMargin[0], worst = byMargin[byMargin.length-1];
  const byDrPct = [...valid].sort((a,b) => b.dr/b.rev - a.dr/a.rev);
  const heaviestDr = byDrPct[0];

  const bestPct = (best.cont/best.rev*100).toFixed(1);
  const worstPct = (worst.cont/worst.rev*100).toFixed(1);
  const drHeavyPct = (heaviestDr.dr/heaviestDr.rev*100).toFixed(1);

  document.getElementById('insightGrid').innerHTML = `
    <div class="insight-card ic-green">
      <div class="ic-icon">ğŸ†</div>
      <div><div class="ic-title">××¨×•×•×— ×’×‘×•×” ×‘×™×•×ª×¨ â€” ${best.name}</div>
      <div class="ic-body">×ª×¨×•××” ×™×©×™×¨×” ×©×œ <strong>${bestPct}%</strong> ××”×›× ×¡×•×ª (${fmt(best.cont)}). ×–×”×• ×”×¡× ×™×£/××—×œ×§×” ×¢× ×”-ROI ×”×˜×•×‘ ×‘×™×•×ª×¨ â€” ××•×¢××“ ×œ×”×¨×—×‘×ª ×”×©×§×¢×”.</div></div>
    </div>
    <div class="insight-card ic-red">
      <div class="ic-icon">âš ï¸</div>
      <div><div class="ic-title">××¨×•×•×— × ××•×š â€” ${worst.name}</div>
      <div class="ic-body">×ª×¨×•××” ×™×©×™×¨×” ×©×œ <strong>${worstPct}%</strong>. ${parseFloat(worstPct)<0?'×ª×¨×•××” ×©×œ×™×œ×™×ª â€” ×”×”×•×¦××•×ª ×¢×•×œ×•×ª ×¢×œ ×”×”×›× ×¡×•×ª. ×“×•×¨×© ×‘×“×™×§×” ××™×™×“×™×ª.':'××¨×•×•×— × ××•×š ×”×“×•×¨×© ×©×™×¤×•×¨ ×‘×™×¢×™×œ×•×ª ×ª×¤×¢×•×œ×™×ª.'}</div></div>
    </div>
    <div class="insight-card ic-blue">
      <div class="ic-icon">ğŸ’¡</div>
      <div><div class="ic-title">×¢×œ×•×ª ×©×›×¨ ×¨×•×¤××™× ×’×‘×•×”×” â€” ${heaviestDr.name}</div>
      <div class="ic-body">×©×›×¨ ×¨×•×¤××™× ×¢×•××“ ×¢×œ <strong>${drHeavyPct}%</strong> ××”×›× ×¡×•×ª. ×›×“××™ ×œ×‘×—×•×Ÿ ××•×“×œ ×©×›×¨ ×—×œ×•×¤×™ ××• ×”×’×“×œ×ª ×”×›× ×¡×•×ª ×‘××•×ª×• ×ª×—×•×.</div></div>
    </div>
  `;
}

renderAll();

// â”€â”€â”€ BRANCH COMPARISON â”€â”€â”€
const BRANCHES_LIST = ['×›×¤×¨ ×¡×‘×','×¨×—×•×‘×•×ª','×‘××¨ ×©×‘×¢','×—×™×¤×”','××•×¦×§×™×Ÿ'];
let compView = 'revenue';
let compChart = null;

const BRANCH_COLORS = {
  '×›×¤×¨ ×¡×‘×':'#0891b2','×¨×—×•×‘×•×ª':'#7c3aed','×‘××¨ ×©×‘×¢':'#059669','×—×™×¤×”':'#0284c7','××•×¦×§×™×Ÿ':'#d97706'
};

function setCompView(v, el) {
  compView = v;
  document.querySelectorAll('.ctab').forEach(b => b.classList.remove('active'));
  if (el) el.classList.add('active');
  renderComparison();
}

function renderComparison() {
  const branches = BRANCHES_LIST.map(k => ({ name: k, color: BRANCH_COLORS[k], ...ALL[k] }));

  const getVal = (b) => {
    if (compView === 'margin')  return b.rev > 0 ? b.cont / b.rev * 100 : 0;
    if (compView === 'revenue') return b.rev;
    if (compView === 'contrib') return b.cont;
    if (compView === 'dr')      return b.rev > 0 ? b.dr / b.rev * 100 : 0;
  };
  const isPercent = compView === 'margin' || compView === 'dr';
  const fmtVal = v => isPercent ? v.toFixed(1) + '%' : fmt(v);
  const labelMap = { margin:'××¨×•×•×—', revenue:'×”×›× ×¡×•×ª', contrib:'×ª×¨×•××” ×™×©×™×¨×”', dr:'×©×›×¨ ×¨×•×¤××™× %' };

  const vals  = branches.map(b => getVal(b));
  const maxVal = Math.max(...vals.map(Math.abs));
  const sorted = branches.map((b,i) => ({ ...b, val: vals[i] })).sort((a,b) => b.val - a.val);

  // Cards
  document.getElementById('compGrid').innerHTML = sorted.map((b, rank) => {
    const pct = maxVal > 0 ? Math.max(0, b.val / maxVal * 100) : 0;
    const col = b.val < 0 ? '#dc2626' : b.color;
    return `
      <div class="comp-card" style="--cc:${col}">
        <div class="cc-rank">${rank+1}</div>
        <div class="cc-name"><span class="cc-dot"></span>${b.name}</div>
        <div class="cc-big" style="--ccol:${col}">${fmtVal(b.val)}</div>
        <div class="cc-lbl">${labelMap[compView]}</div>
        <div class="cc-bar-wrap">
          <div class="cc-bar-track">
            <div class="cc-bar-fill" style="width:${pct}%;background:${col}"></div>
          </div>
          <div class="cc-bar-sub">×”×›× ×¡×•×ª: ${fmt(b.rev)}</div>
        </div>
      </div>`;
  }).join('');

  // Horizontal bar chart
  if (compChart) compChart.destroy();
  compChart = new Chart(document.getElementById('compChart').getContext('2d'), {
    type: 'bar',
    data: {
      labels: sorted.map(b => b.name),
      datasets: [{
        label: labelMap[compView],
        data: sorted.map(b => isPercent ? parseFloat(b.val.toFixed(2)) : b.val),
        backgroundColor: sorted.map(b => (b.val < 0 ? '#dc2626' : b.color) + 'bb'),
        borderColor:     sorted.map(b => b.val < 0 ? '#dc2626' : b.color),
        borderWidth: 2, borderRadius: 8,
        hoverBackgroundColor: sorted.map(b => b.val < 0 ? '#dc2626' : b.color),
      }]
    },
    options: {
      responsive: true, maintainAspectRatio: false, indexAxis: 'y',
      plugins: {
        legend: { display: false },
        tooltip: {
          rtl: true, backgroundColor:'#152847', titleColor:'#fff',
          bodyColor:'rgba(255,255,255,0.85)', borderColor:'rgba(255,255,255,0.1)',
          borderWidth:1, padding:12,
          callbacks: {
            label: c => ` ${labelMap[compView]}: ${fmtVal(c.raw)}`,
            afterLabel: c => {
              const b = sorted[c.dataIndex];
              return [` ×”×›× ×¡×•×ª: ${fmt(b.rev)}`, ` ×ª×¨×•××” ×™×©×™×¨×”: ${fmt(b.cont)}`];
            }
          }
        }
      },
      scales: {
        x: { ticks:{ color:'#94a3b8', font:{family:'Heebo',size:11}, callback: v => isPercent ? v+'%' : fmt(v) }, grid:{ color:'#f0f4fb' } },
        y: { ticks:{ color:'#374151', font:{family:'Heebo',size:12,weight:'700'} }, grid:{ display:false } }
      }
    }
  });
}

renderComparison();
</script>
</body>
</html>
